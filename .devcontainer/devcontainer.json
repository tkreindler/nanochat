// For format details, see https://aka.ms/devcontainer.json.
{
	"name": "Ubuntu",
	"image": "mcr.microsoft.com/devcontainers/base:noble",
	// Features to add to the dev container. More info: https://containers.dev/features.
	"features": {
		// CUDA support with GPU passthrough
		"ghcr.io/devcontainers/features/nvidia-cuda:2": {},

		// Powershell for scripting
		"ghcr.io/devcontainers/features/powershell:1": {},

		// Rust for the tokenizer
		"ghcr.io/devcontainers/features/rust:1": {},

		// .Net for c# conversion
		"ghcr.io/devcontainers/features/dotnet:2": {},

		// OpenCode AI assistant
		"ghcr.io/jsburckhardt/devcontainer-features/opencode:1": {},

		// Bootstrap uv in the container
		"ghcr.io/devcontainers-extra/features/uv:1": {}

		// Everything else (python and pytorch stuff) gets taken care of by uv
	},

	// Bootstrap uv for the container
	"postCreateCommand": "dev/bootstrap.ps1",

	"containerEnv": {
		// Set this home directory to be the root env install for uv
		"UV_PROJECT_ENVIRONMENT": "/workspaces/nanochat/.venv",

		// Set a folder on your main drive to cache the outputs
		"NANOCHAT_BASE_DIR": "/workspaces/nanochat/.nanochat-cache"
	},
	"remoteEnv": {
		// Add the uv python configuration to the PATH
		"PATH": "${containerEnv:UV_PROJECT_ENVIRONMENT}/bin:${containerEnv:PATH}"
	},
	
	// Pass-through the GPU for CUDA if one is available
	"hostRequirements": {
		"gpu": "optional"
	},

	"customizations": {
		"vscode": {
			"extensions": [
				"ms-python.python",
				"ms-vscode.powershell",
				"rust-lang.rust-analyzer"
			]
		}
	}
}